<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoom Link</title>
    <link rel="stylesheet" href="../../static/styles/student/waiting-page.css">
    <link rel="icon" type="Acads.png" href="../../static/img/Cardi Icon.png">
    <script>
        const logoutUrl = "{{ url_for('logout') }}";

        function logout() {
            if (confirm('Are you sure you want to logout? You will be kicked out of the queue.')) {
                window.location.href = logoutUrl;
            } else
                return false;

        }

        setInterval(function () {
            $.ajax({
                url: '{{ url_for("student_register") }}',
                type: 'GET',
                success: function (data) {
                    var queue_count = data.queue_count;
                    var queue_order = data.queue_order;
                    var adviser_in_charge = data.adviser_in_charge;
                    var queue_status = data.queue_status;

                    // Update the content of the page with the new data
                    $('#queue-count').text(queue_count);
                    $('#queue-order').text(queue_order);
                    $('.adviser-in-charge').text(adviser_in_charge);

                    if (queue_order === 1) {
                        window.location.href = dummyUrl;
                        $('#zoom-link').show();


                    }
                }
            });
        }, 500); // send request every 0.5 seconds

        // function that checks the queue status every 5 seconds
        function checkQueueStatus() {
            // make a GET request to the server to get the current queue status
            fetch('/get_queue_status')
                .then(response => response.json())
                .then(data => {
                    // check if the queue status has changed to "Fulfilled"
                    if (data.queue_status === 'Fulfilled') {
                        // redirect to the feedback page
                        window.location.href = '/feedback';
                    }
                })
                .catch(error => console.error(error));
        }

        // call the checkQueueStatus function every 5 seconds
        setInterval(checkQueueStatus, 500);
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

<header>
    <h1 class="head">Welcome, {{ user.student_name }}!</h1>
</header>

<div class="container">
    <div class="image">
        <img src="../../static/img/mymapua.png" alt="My Image" style="max-width: 150px;">
    </div>

    <div class="TableHead">
        <h2>System Status</h2>
    </div>

    <div class="grid-containertable">
        <div class="grid-item-table">
            <h2>Total in Queue</h2>
            <p id="queue-count" class="table-data"></p>
        </div>

        <div class="grid-item-table">
            <h2>Adviser in Charge</h2>
            <p class="table-data">{{ adviser_in_charge }}</p>
        </div>

        <div class="grid-item-table ">
            <h2>Position in Queue</h2>
            <p id="queue-order" class="table-data"></p>
        </div>
    </div>


    <div class="grid-container2">
        <div class="grid-item"><a href="#"
                                  class="button">Zoom Link:</a></div>
        <div class="grid-item">
            <p class="zoom-link" id="zoom-link">
                <b>Click here:</b> <a href="{{ zoom_link }}">{{ zoom_link }}</a>
            </p>
        </div>
        <div class="grid-item"><a href="#" onclick="logout()" class="button">Log Out</a></div>


    </div>
</div>
</body>
</html>
